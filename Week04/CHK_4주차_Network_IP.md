노션
https://aerial-cap-9df.notion.site/4-IP-858d43c997944c1f80661646397ae6bf

# #4. IP & 네트워크

# OSI 7계층 :: 네트워크 계층

네트워크 계층은 경로를 선택하고 주소를 정한 뒤, 경로에 따라 패킷을 전달해 주는 역할을 한다. 이 계층의 대표적인 장비는 라우터이며, 요즘은 2계층의 장비 중 스위치라는 장비에 **라우팅** 기능을 장착한 Layer 3 스위치도 있다. 라우터에서 **IP 주소**를 활용하며, 위에서 언급한 주소를 정한다는 것이 바로 IP 주소를 의미한다. 참고로 네이버나 구글 같은 도메인 주소를 55.10.54.75 같은 IP 주소로 변환하는 행위를 **DNS**라고 한다.

B라는 지점에 IP 주소인 55.10.54.75를 부여하고, A에서 B까지 경로를 찾기 위한 라우팅 기술을 사용하는 것이다.

**라우터**를 통해 경로를 선택하여 **IP**주소를 지정하고 **경로에 따라 패킷을 전달**해준다.

# **라우터**

하나의 스위치에 연결되어 있는 컴퓨터들의 모음을 하나의 ‘네트워크’로 표현할 때, 네트워크 계층은 서로 다른 네트워크 간의 통신을 가능하게 해준다. 즉, 서로 다른 네트워크에 속한 컴퓨터들끼리 데이터를 주고 받을 수 있다. **라우터가 서로 다른 네트워크를 연결해준다.**

1계층에서 허브라는 장비를 사용했고, 2계층에서 스위치라는 장비를 사용했다면 3계층에서는 라우터(router)라는 장비를 사용한다. 2계층 데이터링크 계층에서는 데이터를 전송하기 위해 상대방 맥 주소가 필요하다. 이와 비슷하게 3계층에서는 상대방의 IP 주소를 알아야 데이터를 전송할 수 있다. 또한 목적지인 상대방 IP 주소 뿐만 아니라 어떤 경로로 보낼지도 결정해야하는데 이를 라우팅(routing)이라고 한다.

컴퓨터 1이 다른 네트워크에 존재하는 컴퓨터2 로 패킷을 보낸다고 했을 때 이를 전송하려면 라우터의 IP 주소가 필요하다. 이처럼 네트워크의 출입구 설정을 기본 게이트웨이(default gateway)라고 한다.

라우터는 거리에 상관없이 데이터를 보낼수 있다. 그리고 라우터에는 라우팅 테이블(routing table)을 이용해 경로 정보를 등록, 관리한다.

## **IP 주소**

IP 주소는 ISP(인터넷 서비스 제공자)에게 받을 수 있다. ISP는 쉽게 말해 인터넷 사용하려고 신청한 통신사를 의미한다.

IP 버전은 IPv4, IPv6 두 종류가 있다. IPv4는 32비트로 구성되어 있으며, IPv6는 128비트로 구성되어 있다. 기존에는 IPv4를 사용하다가 IP주소가 부족해서 만들어진것이 IPv6 이다.

# IP프로토콜

**인터넷 프로토콜(IP)의 역할**

- **지정한 IP 주소(IP Address)에 데이터 전달**
- **패킷(Packet)이라는 통신 단위로 데이터 전달**

이러한 전송하고자하는 정보 데이터의 형식을 **패킷이라는 하나의 블록 단위**로 이루어서 **출발지IP에서 목적지 IP까지 패킷을 통해서 전달하고자하는 데이터를 전달**한다.

* IP 패킷 : 전송 데이터를 무사히 전송하기 위해 출발지 IP, 목적지 IP와 같은 정보 포함

# IP 헤더 구조

IP패킷은 정해진 구성에 따라서 특정한 데이터의 길이를 가지고 있는 복잡한 데이터의 구성으로 이루어져 있다. IP헤더 필드에 패킷을 목적지까지 전송하기 위해 IP계층에서 필요한 값들이 담겨져 있다.

![https://blog.kakaocdn.net/dn/cotHqu/btrajqbNLIq/kHMIv7q9lXkkrvNTx8gFOk/img.png](https://blog.kakaocdn.net/dn/cotHqu/btrajqbNLIq/kHMIv7q9lXkkrvNTx8gFOk/img.png)

![https://blog.kakaocdn.net/dn/c8Usqc/btraZLxT6Dz/CfVTDQL1qlJ9xHlHKjJSK0/img.png](https://blog.kakaocdn.net/dn/c8Usqc/btraZLxT6Dz/CfVTDQL1qlJ9xHlHKjJSK0/img.png)

- **버전**
- **헤더길이**
- **서비스타입**
- **식별자**
- **플래그**
- **단편화 오프셋**
- **Time-To-Live(TTL)**
- **프로토콜**
- **헤더 체크섬**
- **송신자 IP주소**
- **수신자 IP주소**

기본적으로 IP header는 '패킷을 어디로 어떻게 처리할지'를 위한 정보를 담고있다.

따라서 패킷 처리에 필요한 정보들을 IP header에서 관리하고 있다. 대표적인 내용을 살펴보면 아래와 같다. 참고로 기본적으로 **IP header는 20bytes**이다.

- **ver** : IP 프로토콜의 버전 정보
- **header len** : IP 프로토콜의 헤더 길이를 32비트 워드 단위로 표시한다.
- **type of service** : network layer에서 제공해주는 서비스에 필요한 정보.
- **Packet Length(패킷 길이)** : IP 헤더를 포함하여 패킷의 전체 길이를 나타낸다.
- **identifier, flags, offset** : fragmentation에 필요한 정보
- **time to live** : 송신 호스트가 패킷을 전송하기 전에 네트워크에서 생존할 수 있는 시간을 지정하고, 각 라우터에서는 패킷이 지나갈 때마다 필드 값을 감소시키면서 패킷을 중개한다. 임의의 라우터에서 Time To Live 값이 0으로 감소하면 패킷은 자동으로 버려진다.
- **Transport(전송 프로토콜)** : IP 프로토콜에 데이터 전송을 요구한 전송 계층의 프로토콜을 가리킨다.
- **Header Checksum(헤더 체크섬)** : 전송 과정에서 발생할 수 있는 헤더 오류를 검출하는 기능이다.
- **Options(옵션)** : 네트워크 관리나 보안처럼 특수 용도로 이용할 수 있다.
- **Padding(패딩)** : IP 헤더의 크기는 16비트 워드의 크기가 4의 배수가 되도록 설계되어 있다. 필드의 전체 크기가 이 조건에 맞지 않으면 이 필드를 사용해 조정할 수 있다.

IP 헤더의 두 번째 워드에는 패킷 분할과 관련된 정보가 포함된다.

- **Identification(식별자 혹은 구분자)** : 송신 호스트가 지정하는 패킷 구분자 기능을 수행한다. IP 프로토콜이 분할한 패킷들에 동일한 고유 번호를 부여함으로써, 수신 호스트가 Identification 번호가 같은 패킷을 다시 병합할 수 있도록 해준다.
- **DF** : 패킷이 분할되지 않도록 한다.
- **MF** : 분할된 패킷을 전송할 때는 여러 개의 분할 패킷이 연속해서 전송되므로 MF 필드 값을 1로 지정하여, 분할 패킷이 뒤에 계속됨을 표시해주어야 한다. 분할 패킷 중 마지막 패킷은 MF 비트를 0으로 지정하여 분할 패킷이 더 없음을 표시한다.
- **Fragment Offset(분할 옵셋)** : 패킷 분할이 이루어지면 12비트의 Fragment Offset 필드를 사용한다. 저장되는 값은 분할된 패킷의 내용이 원래의 분할 전 데이터에서 위치하는 상대 주소 값이고, 값은 8바이트의 배수이다.


# **IP 프로토콜의 한계점**

- **비연결성(connectionlessness)**
    - **패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷을 전송한다.**
- **비신뢰성(unreliability)**
    - **중간에 패킷이 사라져도 IP 프로토콜에서 전송하는 데이터가 정확하게 갔는지 확인하지 않는다. (패킷 전달 여부에 대해서 보증하지 않는다). 패킷이 중간에 소실이 되어버려도 어쩔수 없다는 한계가 있다.**
    - **패킷을 보낸 순서와 받는 순서가 다를 수 있다. 여러개의 패킷이 전달되지만 순서를 보장해주지 않기 때문이다. 따라서 데이터의 순서가 맞지 않을 수 있다.**
- **프로그램 구분**
    - **같은 IP를 사용하는 서버에서 통신하는 애플리케이션이 여러개일 경우 구분이 어렵다. (IP 주소는 해당 기기의 고유한 주소인데 해당 주소에서 여러개의 애플리케이션에 대한 구분이 어려움)**

→ **이러한 IP 프로토콜의 한계를 극복한 프로토콜 = TCP 프로토콜**

# 주소 관련 필드

Source Address는 송신 호스트의 IP 주소이고, Destination Address는 수신 호스트의 IP 주소이다.

![https://blog.kakaocdn.net/dn/dl5bZn/btraVUWH836/7XiLTFy6jb0xJa7fBGBZCk/img.png](https://blog.kakaocdn.net/dn/dl5bZn/btraVUWH836/7XiLTFy6jb0xJa7fBGBZCk/img.png)

IP 주소 체계는 크게 다섯 종류이다.클래스 A, B, C는 유니캐스팅에서 이용하고, 클래스 D는 멀티캐스팅에서 이용한다.클래스 E는 향후의 새로운 응용 환경을 위하여 잠정적으로 예약된 클래스이다.클래스 A, B, C는 주소를 network와 host 필드로 구분해 관리함으로써, 클래스별로 네트워크 크기에 따라 주소 관리를 다르게 한다.

- **network(네트워크)** : 네트워크 주소이다.
- **host(호스트)** : 네트워크 주소가 결정되면 하위의 호스트 주소를 의미하는 host 비트 값을 개별 네트워크의 관리자가 할당한다.



# 패킷 분할(**IP fragmentation)**

IP 패킷 (datagram)은 다양한 라우터들을 거쳐 전송된다.

전송되는 과정에서 사용하게되는 link의 크기가 크면 좋겠지만, 중간에 작은 크기의 link를 지나갈 수도 있다. 이럴때, **큰 크기의 datagram은 통과할 수 없으므로 이를 fragmentation 시키는 과정**이 필요하다.

즉, 하나의 datagram이 여러개의 datagram으로 잘라지는 것이다.

중요한 점은 잘려진 datagram들은 link가 넓어졌다고 다시 바로 합쳐지는게 아니라, **목적지 host에 모두 도착하고 나서야 다시 합쳐진다**는 점이다.

## 분할의 필요성

![https://blog.kakaocdn.net/dn/FzZzO/btraXVU52rf/6Gs8bFcon4xsNjSDnnQJ01/img.png](https://blog.kakaocdn.net/dn/FzZzO/btraXVU52rf/6Gs8bFcon4xsNjSDnnQJ01/img.png)

패킷 분할의 필요성

IP 프로토콜의 분할 기능은 전송 경로에 위치한 라우터에 의해 수행된다.라우터의 좌우에 연결된 LAN이 서로 다를 수 있기 때문에 데이터 링크 계층의 위치한 프레임 크기가 프로토콜마다 달라진다.따라서 데이터를 수신한 이후에 패킷을 중개하는 방향에 위치한 LAN에 맞도록 프레임을 분할해 주어야 한다.

# DHCP 프로토콜

특정 네트워크를 관리하는 네트워크 관리자는 개별 호스트들에 수동으로 고정 IP 주소를 할당할 수 있다. 그러나 IP 주소 부족 등의 사유로 DHCPDynamic Host Configuration Protocol를 사용하여 자동으로 할당할 수도 있다. 예를 들어, 대학 내의 여러 실습실에 1,000대의 컴퓨터가 설치되어 있다고 가정하면 1,000개의 고정 IP 주소를 할당해야 한다.그러나 실습 수업이 동시에 이루어지지 않기 때문에 DHCP를 사용하여 현재 사용하는 컴퓨터에만 IP 주소를 자동으로 할당하는 것이 가능하다.이렇게 IP 주소를 여러 컴퓨터가 공유해서 사용하면 더 적은 수의 IP 주소만으로도 1,000대의 컴퓨터가 시간 분할 방식으로 인터넷에 접속할 수 있다.



---
질문

1.도메인 주소를 IP 주소로 변환하는 행위를 무엇이라고 하나요?

2.IP프로토콜의 한계점 2가지와, 이 한계점을 극복하기 위해 등장한 프로토콜의 이름은?
